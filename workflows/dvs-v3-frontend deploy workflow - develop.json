{
  "active": false,
  "connections": {
    "When clicking \"Test workflow\"": {
      "main": [
        [
          {
            "node": "Clone from repo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Install Yarn Package Manager": {
      "main": [
        [
          {
            "node": "Set max-heap Memory",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set max-heap Memory": {
      "main": [
        [
          {
            "node": "Yarn install (install yarn packages)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Yarn install (install yarn packages)": {
      "main": [
        [
          {
            "node": "yarn build",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "yarn build": {
      "main": [
        [
          {
            "node": "create a nginx config file in sites-enabled directory",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "create a nginx config file in sites-enabled directory": {
      "main": [
        [
          {
            "node": "Test nginx1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Test nginx1": {
      "main": [
        [
          {
            "node": "Reload nginx",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Reload nginx": {
      "main": [
        [
          {
            "node": "Slack",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "copy .env": {
      "main": [
        [
          {
            "node": "export and load nvm",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "git stash & checkout to develop": {
      "main": [
        [
          {
            "node": "git pull develop",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "git pull develop": {
      "main": [
        [
          {
            "node": "copy .env",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Clone from repo": {
      "main": [
        [
          {
            "node": "git stash & checkout to develop",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Use nvm V18": {
      "main": [
        [
          {
            "node": "Install Yarn Package Manager",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "export and load nvm": {
      "main": [
        [
          {
            "node": "Use nvm V18",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2024-05-14T16:32:02.179Z",
  "id": "y8J3SnykjflufIr9",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "dvs-v3-frontend deploy workflow - develop",
  "nodes": [
    {
      "parameters": {},
      "id": "02e5640f-38e8-443d-86a5-95ea170293f5",
      "name": "When clicking \"Test workflow\"",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        320,
        320
      ]
    },
    {
      "parameters": {
        "content": "## Setting up trigger for the workflow",
        "height": 657.0559056155266,
        "width": 665.586823529412,
        "color": 6
      },
      "id": "a95450b4-0d29-4f87-bef8-560a8aa55801",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        66.84342857142838,
        220
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## SSH into VM and pull the develop branch\nUse respective credentials for SSH\nDoing git stash and checkout to develop branch\nthen pull from develop branch",
        "height": 505.2093700861147,
        "width": 744.758350015788,
        "color": 6
      },
      "id": "9b610886-b92a-4733-b894-537b559a7d0c",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        800,
        220
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Setting up .env\nJust some of commands to copy .env.example to .env",
        "height": 435.92864511132495,
        "width": 475.4747428571427,
        "color": 6
      },
      "id": "b2a3976c-a6cb-48b2-bdf5-def30d5c4633",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1640,
        220
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Installing and Setting up Yarn Package Manager ---> running build\nCommand to install and setup yarn package manager\nCommand to set the heap size\nCommand to install project packages using yarn\nCommand to build the yarn project",
        "height": 731.3844837667864,
        "width": 1321.693015126049,
        "color": 6
      },
      "id": "ad0c47af-c587-45b3-8484-8e06474a110e",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2180,
        220
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Setting up nginx config, testing and reloading\nThis portion contains the commands to setup the nginx config file in /etc/nginx/sites-enabled directory.\n\nThen test the nginx connection and then reload it.",
        "height": 433.629377884434,
        "width": 787,
        "color": 6
      },
      "id": "f0aebd5f-696c-4e8d-ae31-794d8bd18aeb",
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        3540,
        220
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Setting up Slack for providing notification of success with the various deployment details.",
        "height": 379.5965980525016,
        "width": 519.4161210084033,
        "color": 6
      },
      "id": "6151a710-bcad-4dae-9713-86b6347e336c",
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        4360,
        240
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "authentication": "privateKey",
        "command": "source ~/.nvm/nvm.sh && sudo npm install -g yarn",
        "cwd": "/home/ubuntu/Projects/dvs-v3-frontend"
      },
      "id": "8209ebb8-c070-4078-ad4b-fb2e1b91ff5a",
      "name": "Install Yarn Package Manager",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [
        2580,
        440
      ],
      "executeOnce": false,
      "alwaysOutputData": false,
      "credentials": {
        "sshPrivateKey": {
          "id": "aDoEMAgfjOxUDXWv",
          "name": "SSH Password account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "privateKey",
        "command": "export NODE_OPTIONS=\"--max-old-space-size=4096\"",
        "cwd": "/home/ubuntu/Projects/dvs-v3-frontend"
      },
      "id": "2b995eac-924d-4cee-aa97-ef3091fac8d4",
      "name": "Set max-heap Memory",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [
        2800,
        600
      ],
      "executeOnce": false,
      "alwaysOutputData": false,
      "credentials": {
        "sshPrivateKey": {
          "id": "aDoEMAgfjOxUDXWv",
          "name": "SSH Password account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "privateKey",
        "command": "source ~/.nvm/nvm.sh && yarn cache clean && yarn install",
        "cwd": "/home/ubuntu/Projects/dvs-v3-frontend"
      },
      "id": "049e3e16-d2e0-4d13-a01c-6d3074809fb0",
      "name": "Yarn install (install yarn packages)",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [
        3060,
        480
      ],
      "executeOnce": false,
      "alwaysOutputData": false,
      "credentials": {
        "sshPrivateKey": {
          "id": "aDoEMAgfjOxUDXWv",
          "name": "SSH Password account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "privateKey",
        "command": "source ~/.nvm/nvm.sh && yarn build",
        "cwd": "/home/ubuntu/Projects/dvs-v3-frontend"
      },
      "id": "96f6a6d5-1ad6-4a9e-b00f-b60f2d0bda37",
      "name": "yarn build",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [
        3320,
        620
      ],
      "executeOnce": false,
      "alwaysOutputData": false,
      "notesInFlow": false,
      "credentials": {
        "sshPrivateKey": {
          "id": "aDoEMAgfjOxUDXWv",
          "name": "SSH Password account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "privateKey",
        "command": "sudo bash -c \"echo ' server {\n    listen 80;\n    server_name dvs-dev.anilrajrimal.com.np;    # domain name to respond to\n    access_log /var/log/nginx/dvs-dev.anilrajrimal.com.np.access;\n    error_log /var/log/nginx/dvs-dev.anilrajrimal.com.np.error;\n\n    client_max_body_size 500M;            # Allow uploads/transper to 100MB.\n    client_body_buffer_size 128k;\n\n    gzip on;            # Allows compression; can be CPU intensive\n    gzip_min_length 150;\n    gzip_types    text/plain text/css application/javascript application/x-javascript text/javascript image/x-icon image/svg+xml image/png application/json ;\n\n              root /home/ubuntu/Projects/dvs-v3-frontend/dist;\n              index  index.html index.htm;\n     location / {\n              add_header Access-Control-Allow-Origin *;\n              try_files \\$uri /index.html;            # if no endpoint found try index.html\n             }\n\n}' > /etc/nginx/sites-enabled/dvs-dev.anilrajrimal.com.np.conf\"\n",
        "cwd": "/etc/nginx/sites-enabled"
      },
      "id": "f17144f3-b38c-4573-a1c0-f35952f148d8",
      "name": "create a nginx config file in sites-enabled directory",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [
        3660,
        460
      ],
      "executeOnce": false,
      "alwaysOutputData": false,
      "credentials": {
        "sshPrivateKey": {
          "id": "aDoEMAgfjOxUDXWv",
          "name": "SSH Password account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "privateKey",
        "command": "sudo nginx -t",
        "cwd": "/etc/nginx/sites-enabled"
      },
      "id": "d70f48dd-27d6-424b-af73-53c91ab90b7d",
      "name": "Test nginx1",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [
        3900,
        360
      ],
      "executeOnce": false,
      "alwaysOutputData": false,
      "credentials": {
        "sshPrivateKey": {
          "id": "aDoEMAgfjOxUDXWv",
          "name": "SSH Password account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "privateKey",
        "command": "sudo nginx -s reload",
        "cwd": "/etc/nginx/sites-enabled"
      },
      "id": "f5765bf9-29cb-49be-8b47-2802a81ee657",
      "name": "Reload nginx",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [
        4120,
        460
      ],
      "executeOnce": false,
      "alwaysOutputData": false,
      "credentials": {
        "sshPrivateKey": {
          "id": "aDoEMAgfjOxUDXWv",
          "name": "SSH Password account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C073V4SMDJ5",
          "mode": "list",
          "cachedResultName": "dvs-frontend-v3"
        },
        "text": "Congratulations !!!\nYour site is live at ::: https://dvs-dev.anilrajrimal.com.np\nGo and Check it once !!",
        "otherOptions": {}
      },
      "id": "864d4fca-7aa3-458b-a671-1447fe91d041",
      "name": "Slack",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.1,
      "position": [
        4540,
        400
      ],
      "executeOnce": true,
      "credentials": {
        "slackOAuth2Api": {
          "id": "oytOvgZOMj4GVobW",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "privateKey",
        "command": "cp .env.example .env",
        "cwd": "/home/ubuntu/Projects/dvs-v3-frontend"
      },
      "id": "8b98d1b7-1894-4d60-af28-8afd027addb1",
      "name": "copy .env",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [
        1700,
        340
      ],
      "executeOnce": false,
      "alwaysOutputData": false,
      "credentials": {
        "sshPrivateKey": {
          "id": "aDoEMAgfjOxUDXWv",
          "name": "SSH Password account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "privateKey",
        "command": "git stash && git checkout develop",
        "cwd": "/home/ubuntu/Projects/dvs-v3-frontend"
      },
      "id": "dfc8bf90-4d8c-49c2-aec8-16d0ab9939d8",
      "name": "git stash & checkout to develop",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [
        1120,
        340
      ],
      "executeOnce": false,
      "alwaysOutputData": false,
      "credentials": {
        "sshPrivateKey": {
          "id": "aDoEMAgfjOxUDXWv",
          "name": "SSH Password account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "authentication": "privateKey",
        "command": "git pull origin develop",
        "cwd": "/home/ubuntu/Projects/dvs-v3-frontend"
      },
      "id": "07965c4b-dcc0-4c9e-a5a7-c6b35b6e60e8",
      "name": "git pull develop",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [
        1340,
        440
      ],
      "executeOnce": false,
      "alwaysOutputData": false,
      "credentials": {
        "sshPrivateKey": {
          "id": "aDoEMAgfjOxUDXWv",
          "name": "SSH Password account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "authentication": "privateKey",
        "command": "git clone git@github.com:naxa-developers/dvs-v3-frontend.git",
        "cwd": "/home/ubuntu/Projects/"
      },
      "id": "fa654fe7-31af-485a-a185-652ffba122c1",
      "name": "Clone from repo",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [
        880,
        460
      ],
      "executeOnce": false,
      "alwaysOutputData": false,
      "credentials": {
        "sshPrivateKey": {
          "id": "aDoEMAgfjOxUDXWv",
          "name": "SSH Password account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "authentication": "privateKey",
        "command": "source ~/.nvm/nvm.sh && nvm use 18",
        "cwd": "/home/ubuntu/Projects/dvs-v3-frontend"
      },
      "id": "b1d1fe8c-23af-4207-9190-23feae7ab8ea",
      "name": "Use nvm V18",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [
        2340,
        620
      ],
      "executeOnce": false,
      "alwaysOutputData": false,
      "credentials": {
        "sshPrivateKey": {
          "id": "aDoEMAgfjOxUDXWv",
          "name": "SSH Password account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "privateKey",
        "command": "export NVM_DIR=\"$HOME/.nvm\"\n[ -s \"$NVM_DIR/nvm.sh\" ] && \\. \"$NVM_DIR/nvm.sh\"\n[ -s \"$NVM_DIR/bash_completion\" ] && \\. \"$NVM_DIR/bash_completion\"",
        "cwd": "/home/ubuntu/Projects/dvs-v3-frontend"
      },
      "id": "019f1cab-3545-4081-92b9-3d9e024f0b34",
      "name": "export and load nvm",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [
        1960,
        440
      ],
      "executeOnce": false,
      "alwaysOutputData": false,
      "credentials": {
        "sshPrivateKey": {
          "id": "aDoEMAgfjOxUDXWv",
          "name": "SSH Password account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "owner": {
          "__rl": true,
          "value": "naxa-developers",
          "mode": "list",
          "cachedResultName": "naxa-developers",
          "cachedResultUrl": "https://github.com/naxa-developers"
        },
        "repository": {
          "__rl": true,
          "value": "https://github.com/naxa-developers/dvs-v3-frontend",
          "mode": "url"
        },
        "events": [
          "push"
        ],
        "options": {}
      },
      "id": "6d2d0f52-8f2b-40d0-a77e-51cc54fff8b2",
      "name": "Github Trigger",
      "type": "n8n-nodes-base.githubTrigger",
      "typeVersion": 1,
      "position": [
        320,
        580
      ],
      "webhookId": "6fbecdb2-9ff2-4237-92fd-6af31bcb5ce0",
      "credentials": {
        "githubOAuth2Api": {
          "id": "wBMqs9Q3SKaMY9Xc",
          "name": "GitHub account 2"
        }
      },
      "disabled": true
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2024-05-15T12:17:27.000Z",
  "versionId": "71356397-2928-41be-ac70-39198a1d904e"
}